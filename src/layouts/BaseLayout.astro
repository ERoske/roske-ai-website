---
import '../styles/global.css';
import { ClientRouter } from 'astro:transitions';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { currentTheme, themeToCSS } from '../themes/theme-config';

interface Props {
  title?: string;
  description?: string;
  ogImage?: string;
  bodyClass?: string;
}

const {
  title = `Roske.AI | Edward Roske`,
  description = "Edward Roske: CEO, Speaker, Data Scientist, Dungeon Master. Building at the intersection of AI and Finance.",
  ogImage = "/images/og-default.png",
  bodyClass = "",
} = Astro.props;

const theme = currentTheme;
const cssVars = themeToCSS(theme);
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" sizes="16x16 32x32 48x48" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={new URL(ogImage, Astro.site)} />
    <meta property="og:site_name" content="Roske.AI" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@eroske" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={new URL(ogImage, Astro.site)} />

    <!-- Structured Data (JSON-LD) -->
    <script is:inline type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Roske.AI",
      "url": "https://roske.ai",
      "author": {
        "@type": "Person",
        "name": "Edward Roske",
        "jobTitle": "CEO",
        "url": "https://roske.ai",
        "sameAs": [
          "https://www.linkedin.com/in/interrel/",
          "https://x.com/eroske",
          "https://www.youtube.com/@Roske-AI",
          "https://github.com/eroske",
          "https://www.amazon.com/stores/Edward-Roske/author/B00J237CUW"
        ],
        "worksFor": [
          { "@type": "Organization", "name": "Dawnward" },
          { "@type": "Organization", "name": "Caprus" }
        ],
        "alumniOf": [
          { "@type": "CollegeOrUniversity", "name": "Southern Methodist University" },
          { "@type": "CollegeOrUniversity", "name": "Shimer College" }
        ],
        "knowsAbout": ["Artificial Intelligence", "Data Science", "Oracle EPM", "MCP Servers", "Finance", "Public Speaking"]
      }
    })} />

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="Roske.AI Blog" href="/rss.xml" />

    <!-- Fonts (preconnect + preload for performance) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preload" as="style" href={theme.fonts.googleFontsUrl} />
    <link href={theme.fonts.googleFontsUrl} rel="stylesheet" />

    <title>{title}</title>

    <ClientRouter />

    <!-- Theme variables + dark/light mode initialization (no flash) -->
    <script is:inline define:vars={{ cssVars }}>
      // Apply theme before render to prevent flash
      (function() {
        const saved = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const theme = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>

    <style define:vars={{
      colorPrimary: theme.colors.primary,
      colorSecondary: theme.colors.secondary,
      colorAccent: theme.colors.accent,
      colorAccentHover: theme.colors.accentHover,
      colorBg: theme.colors.background,
      colorBgLight: theme.colors.backgroundLight,
      colorSurface: theme.colors.surface,
      colorSurfaceLight: theme.colors.surfaceLight,
      colorText: theme.colors.text,
      colorTextMuted: theme.colors.textMuted,
      colorTextDark: theme.colors.textDark,
      colorTextDarkMuted: theme.colors.textDarkMuted,
      colorBorder: theme.colors.border,
      colorBorderLight: theme.colors.borderLight,
      fontHeading: theme.fonts.heading,
      fontBody: theme.fonts.body,
      fontMono: theme.fonts.mono,
    }}>
      :root {
        --color-primary: var(--colorPrimary);
        --color-secondary: var(--colorSecondary);
        --color-accent: var(--colorAccent);
        --color-accent-hover: var(--colorAccentHover);
        --color-bg: var(--colorBg);
        --color-bg-light: var(--colorBgLight);
        --color-surface: var(--colorSurface);
        --color-surface-light: var(--colorSurfaceLight);
        --color-text: var(--colorText);
        --color-text-muted: var(--colorTextMuted);
        --color-text-dark: var(--colorTextDark);
        --color-text-dark-muted: var(--colorTextDarkMuted);
        --color-border: var(--colorBorder);
        --color-border-light: var(--colorBorderLight);
        --font-heading: var(--fontHeading);
        --font-body: var(--fontBody);
        --font-mono: var(--fontMono);
      }

      /* Dark mode (default) */
      [data-theme="dark"] body {
        background-color: var(--color-bg);
        color: var(--color-text);
      }

      /* Light mode */
      [data-theme="light"] body {
        background-color: var(--color-bg-light);
        color: var(--color-text-dark);
      }

      /* Transition for theme switch */
      body {
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      /* Fade-up entrance animation */
      .animate-on-scroll {
        opacity: 0;
        transform: translateY(24px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }

      .animate-on-scroll.visible {
        opacity: 1;
        transform: translateY(0);
      }
    </style>
  </head>
  <body class:list={["min-h-screen font-[var(--font-body)] antialiased", bodyClass]}>
    <Navigation />
    <main>
      <slot />
    </main>
    <Footer />

    <!-- Scroll animation observer -->
    <script is:inline>
      document.addEventListener('astro:page-load', () => {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });

        document.querySelectorAll('.animate-on-scroll').forEach(el => {
          observer.observe(el);
        });
      });
    </script>
  </body>
</html>
