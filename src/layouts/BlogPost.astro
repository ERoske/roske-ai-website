---
import BaseLayout from './BaseLayout.astro';

interface Coauthor {
  name: string;
  image?: string;
  url?: string;
}

interface Props {
  title: string;
  description: string;
  date: Date;
  tags?: string[];
  slug?: string;
  coauthors?: Coauthor[];
}

const { title, description, date, tags = [], slug = '', coauthors = [] } = Astro.props;

const formattedDate = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
---

<BaseLayout title={`${title} | Roske.AI`} description={description} ogType="article" articleDate={date} articleTags={tags}>

  <!-- NewsArticle JSON-LD for Google News -->
  <script is:inline type="application/ld+json" slot="head" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "headline": title,
    "description": description,
    "datePublished": date.toISOString(),
    "dateModified": date.toISOString(),
    "author": [
      {
        "@type": "Person",
        "name": "Edward Roske",
        "url": "https://roske.ai",
        "sameAs": [
          "https://www.linkedin.com/in/interrel/",
          "https://x.com/eroske"
        ]
      },
      ...coauthors.map(ca => ({
        "@type": ca.url?.includes('anthropic') ? "Organization" : "Person",
        "name": ca.name,
        ...(ca.url ? { "url": ca.url } : {})
      }))
    ],
    "publisher": {
      "@type": "Organization",
      "name": "Roske.AI",
      "url": "https://roske.ai",
      "logo": {
        "@type": "ImageObject",
        "url": "https://roske.ai/icon-512.png"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://roske.ai/blog/${slug}/`
    },
    "image": "https://roske.ai/images/Edward_Roske_Headshot.png"
  })} />

  <!-- BreadcrumbList JSON-LD -->
  <script is:inline type="application/ld+json" slot="head" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://roske.ai"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "Blog",
        "item": "https://roske.ai/blog/"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": title
      }
    ]
  })} />

  <article class="relative py-20 md:py-28 px-6">
    <div class="absolute inset-0 dark:block hidden bg-gradient-to-b from-[var(--color-bg)] to-[var(--color-surface)]"></div>
    <div class="absolute inset-0 dark:hidden block bg-gradient-to-b from-[var(--color-bg-light)] to-gray-50"></div>

    <div class="relative max-w-3xl mx-auto">
      <!-- Header -->
      <header class="mb-12">
        <a href="/blog/" class="inline-flex items-center gap-1 text-sm font-[var(--font-mono)] text-[var(--color-accent)] hover:underline mb-6 block">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          Back to Blog
        </a>

        <!-- Tags above title -->
        {tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-4"
            style="animation: fadeInUp 0.6s ease-out forwards;">
            {tags.map(tag => (
              <a href={`/blog/tag/${tag.toLowerCase().replace(/\s+/g, '-')}/`}
                class="px-2.5 py-1 rounded-full text-xs font-semibold font-[var(--font-mono)] tracking-wide uppercase
                  dark:bg-[var(--color-accent)]/10 dark:text-[var(--color-accent)]
                  bg-[var(--color-accent)]/10 text-[var(--color-accent)]
                  hover:bg-[var(--color-accent)]/20 transition-colors">
                {tag}
              </a>
            ))}
          </div>
        )}

        <h1 class="text-3xl md:text-4xl lg:text-5xl font-black tracking-tight leading-[1.1] mb-6 dark:text-white text-[var(--color-primary)]"
          style="animation: fadeInUp 0.6s ease-out 0.05s forwards; opacity: 0;">
          {title}
        </h1>

        <div class="flex items-center gap-4 flex-wrap"
          style="animation: fadeInUp 0.6s ease-out 0.1s forwards; opacity: 0;">
          <!-- Author info -->
          <div class="flex items-center gap-3">
            <img src="/images/Edward_Roske_Headshot.png" alt="Edward Roske"
              class="w-10 h-10 rounded-full object-cover ring-2 ring-[var(--color-accent)]/20" />
            <div>
              <a href="/about/" class="text-sm font-semibold dark:text-white text-[var(--color-primary)] hover:text-[var(--color-accent)] transition-colors">Edward Roske</a>
              <time datetime={date.toISOString()} class="text-xs dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] block">
                {formattedDate}
              </time>
            </div>
          </div>
          {coauthors.length > 0 && coauthors.map(coauthor => (
            <div class="flex items-center gap-3">
              <span class="text-xs dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)]">&</span>
              {coauthor.image && (
                <img src={coauthor.image} alt={coauthor.name}
                  class="w-10 h-10 rounded-full object-cover ring-2 ring-[var(--color-accent)]/20" />
              )}
              <div>
                {coauthor.url ? (
                  <a href={coauthor.url} class="text-sm font-semibold dark:text-white text-[var(--color-primary)] hover:text-[var(--color-accent)] transition-colors">{coauthor.name}</a>
                ) : (
                  <span class="text-sm font-semibold dark:text-white text-[var(--color-primary)]">{coauthor.name}</span>
                )}
                <span class="text-xs dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] block">Co-author</span>
              </div>
            </div>
          ))}
        </div>
      </header>

      <!-- Divider -->
      <div class="w-16 h-px bg-[var(--color-accent)]/30 mb-10"
        style="animation: fadeInUp 0.6s ease-out 0.15s forwards; opacity: 0;"></div>

      <!-- Content -->
      <div class="blog-content"
        style="animation: fadeInUp 0.6s ease-out 0.2s forwards; opacity: 0;">
        <slot />
      </div>

      <!-- Footer -->
      <footer class="mt-16 pt-8 border-t dark:border-[var(--color-border)] border-[var(--color-border-light)]">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <a href="/blog/" class="inline-flex items-center gap-1 text-sm font-medium text-[var(--color-accent)] hover:underline">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
            All Posts
          </a>
          <p class="text-sm italic dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)]">
            Asking good questions,<br/>Edward
          </p>
        </div>
      </footer>
    </div>
  </article>

</BaseLayout>

<style>
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(24px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Blog content typography */
  .blog-content {
    font-size: 1.125rem;
    line-height: 1.8;
  }

  /* Paragraphs */
  .blog-content :global(p) {
    margin-bottom: 1.5rem;
    color: var(--color-text-dark-muted);
  }
  :global([data-theme="dark"]) .blog-content :global(p) {
    color: var(--color-text-muted);
  }

  /* Headings */
  .blog-content :global(h2) {
    font-size: 1.75rem;
    font-weight: 800;
    letter-spacing: -0.02em;
    margin-top: 3rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border-light);
    color: var(--color-primary);
  }
  :global([data-theme="dark"]) .blog-content :global(h2) {
    color: white;
    border-bottom-color: var(--color-border);
  }

  .blog-content :global(h3) {
    font-size: 1.375rem;
    font-weight: 700;
    letter-spacing: -0.01em;
    margin-top: 2.5rem;
    margin-bottom: 0.75rem;
    color: var(--color-primary);
  }
  :global([data-theme="dark"]) .blog-content :global(h3) {
    color: white;
  }

  /* Strong text */
  .blog-content :global(strong) {
    color: var(--color-primary);
    font-weight: 700;
  }
  :global([data-theme="dark"]) .blog-content :global(strong) {
    color: white;
  }

  /* Links */
  .blog-content :global(a) {
    color: var(--color-accent);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px solid transparent;
    transition: border-color 0.2s;
  }
  .blog-content :global(a:hover) {
    border-bottom-color: var(--color-accent);
  }

  /* Lists */
  .blog-content :global(ul),
  .blog-content :global(ol) {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }
  .blog-content :global(li) {
    margin-bottom: 0.5rem;
    color: var(--color-text-dark-muted);
  }
  :global([data-theme="dark"]) .blog-content :global(li) {
    color: var(--color-text-muted);
  }
  .blog-content :global(ul > li) {
    list-style-type: disc;
  }
  .blog-content :global(ol > li) {
    list-style-type: decimal;
  }
  .blog-content :global(li::marker) {
    color: var(--color-accent);
  }

  /* Blockquotes */
  .blog-content :global(blockquote) {
    margin: 2rem 0;
    padding: 1.25rem 1.5rem;
    border-left: 3px solid var(--color-accent);
    border-radius: 0 0.75rem 0.75rem 0;
    font-style: italic;
    font-size: 1.125rem;
    color: var(--color-text-dark-muted);
    background: rgba(0, 0, 0, 0.02);
  }
  :global([data-theme="dark"]) .blog-content :global(blockquote) {
    color: var(--color-text-muted);
    background: rgba(255, 255, 255, 0.03);
  }
  .blog-content :global(blockquote p) {
    margin-bottom: 0;
  }

  /* Code */
  .blog-content :global(code) {
    font-family: var(--font-mono);
    font-size: 0.875rem;
    padding: 0.15rem 0.4rem;
    border-radius: 0.25rem;
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-accent);
  }
  :global([data-theme="dark"]) .blog-content :global(code) {
    background: rgba(255, 255, 255, 0.08);
  }

  .blog-content :global(pre) {
    margin: 1.5rem 0;
    padding: 1.25rem;
    border-radius: 0.75rem;
    border: 1px solid var(--color-border-light);
    overflow-x: auto;
    background: #f8f8f8;
  }
  :global([data-theme="dark"]) .blog-content :global(pre) {
    background: var(--color-surface);
    border-color: var(--color-border);
  }
  .blog-content :global(pre code) {
    padding: 0;
    background: none;
    color: inherit;
  }

  /* Horizontal rule */
  .blog-content :global(hr) {
    margin: 2.5rem auto;
    border: none;
    width: 4rem;
    height: 1px;
    background: var(--color-border-light);
  }
  :global([data-theme="dark"]) .blog-content :global(hr) {
    background: var(--color-border);
  }

  /* Images */
  .blog-content :global(img) {
    border-radius: 0.75rem;
    margin: 2rem 0;
  }

  /* Emphasis / italics */
  .blog-content :global(em) {
    font-style: italic;
  }

  /* First paragraph larger (drop cap feel) */
  .blog-content > :global(p:first-of-type) {
    font-size: 1.25rem;
    line-height: 1.75;
  }
</style>
