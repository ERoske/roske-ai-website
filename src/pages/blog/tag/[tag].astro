---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Section from '../../../components/Section.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = (await getCollection('blog')).filter(post => !post.data.draft);
  const tags = [...new Set(posts.flatMap(post => post.data.tags))];

  return tags.map(tag => ({
    params: { tag: tag.toLowerCase().replace(/\s+/g, '-') },
    props: {
      tag,
      posts: posts
        .filter(post => post.data.tags.includes(tag))
        .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf()),
    },
  }));
}

const { tag, posts } = Astro.props;
---

<BaseLayout title={`${tag} | Blog | Roske.AI`} description={`Posts tagged "${tag}" on the Roske.AI blog.`}>

  <!-- Hero -->
  <section class="relative py-20 md:py-28 px-6 overflow-hidden">
    <div class="absolute inset-0 dark:block hidden bg-gradient-to-b from-[var(--color-bg)] to-[var(--color-surface)]"></div>
    <div class="absolute inset-0 dark:hidden block bg-gradient-to-b from-[var(--color-bg-light)] to-gray-50"></div>
    <div class="relative max-w-7xl mx-auto">
      <div class="max-w-3xl">
        <a href="/blog/" class="inline-flex items-center gap-1 text-sm font-[var(--font-mono)] text-[var(--color-accent)] hover:underline mb-6">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/></svg>
          All Posts
        </a>
        <h1 class="text-4xl md:text-5xl font-black tracking-tight leading-tight mb-4 dark:text-white text-[var(--color-primary)]"
          style="animation: fadeInUp 0.6s ease-out forwards;">
          {tag}
        </h1>
        <p class="text-lg dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)]"
          style="animation: fadeInUp 0.6s ease-out 0.1s forwards; opacity: 0;">
          {posts.length} post{posts.length !== 1 ? 's' : ''} tagged "{tag}"
        </p>
      </div>
    </div>
  </section>

  <!-- Posts -->
  <Section>
    <div class="space-y-6 max-w-3xl">
      {posts.map(post => (
        <a href={`/blog/${post.id}/`}
          class="animate-on-scroll block rounded-xl p-6 transition-all duration-300 group hover:-translate-y-0.5
            dark:bg-white/[0.03] dark:border dark:border-white/[0.06] dark:hover:border-[var(--color-accent)]/30 dark:hover:bg-white/[0.06]
            bg-white border border-black/[0.06] hover:border-[var(--color-accent)]/30 hover:shadow-lg">
          <div class="flex items-start justify-between gap-4">
            <div>
              <h2 class="text-lg md:text-xl font-bold dark:text-white text-[var(--color-primary)] group-hover:text-[var(--color-accent)] transition-colors leading-snug">
                {post.data.title}
              </h2>
              <p class="dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] text-sm leading-relaxed mt-2">
                {post.data.description}
              </p>
              <time datetime={post.data.date.toISOString()} class="text-xs font-[var(--font-mono)] dark:text-[var(--color-text-muted)]/60 text-[var(--color-text-dark-muted)]/60 mt-3 block">
                {post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
              </time>
            </div>
            <svg class="w-5 h-5 flex-shrink-0 mt-1 opacity-30 group-hover:opacity-100 group-hover:translate-x-1 transition-all dark:text-white text-[var(--color-primary)]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>
          </div>
        </a>
      ))}
    </div>
  </Section>

</BaseLayout>

<style>
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(24px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>
