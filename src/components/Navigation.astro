---
import ThemeToggle from './ThemeToggle.astro';

const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/about/', label: 'About' },
  { href: '/work/', label: 'Work' },
  { href: '/content/', label: 'Content' },
  { href: '/books/', label: 'Books' },
  { href: '/contact/', label: 'Contact' },
];
---

<nav id="main-nav" class="fixed top-0 left-0 right-0 z-40 transition-all duration-300">
  <!-- Backdrop blur bar -->
  <div class="nav-backdrop absolute inset-0 backdrop-blur-xl border-b transition-all duration-300
    dark:bg-[var(--color-bg)]/80 dark:border-[var(--color-border)]/50
    bg-[var(--color-bg-light)]/80 border-[var(--color-border-light)]/50">
  </div>

  <div class="relative max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2 group">
      <span class="text-xl font-black tracking-tighter
        dark:text-white text-[var(--color-primary)]">
        ROSKE<span class="text-[var(--color-accent)]">.</span>AI
      </span>
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-1">
      {navLinks.map(link => (
        <a
          href={link.href}
          class:list={[
            "px-3 py-2 text-sm font-medium rounded-lg transition-all duration-200",
            currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) || (link.href === '/content/' && currentPath.startsWith('/blog/'))
              ? "text-[var(--color-accent)] dark:bg-white/5 bg-black/5"
              : "dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] hover:text-[var(--color-accent)] dark:hover:bg-white/5 hover:bg-black/5"
          ]}
        >
          {link.label}
        </a>
      ))}
      <div class="ml-2 pl-2 border-l dark:border-[var(--color-border)] border-[var(--color-border-light)]">
        <ThemeToggle />
      </div>
    </div>

    <!-- Mobile Menu Button -->
    <div class="flex items-center gap-2 md:hidden">
      <ThemeToggle />
      <button
        id="mobile-menu-btn"
        class="p-2 rounded-lg dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] hover:text-[var(--color-accent)] dark:hover:bg-white/5 hover:bg-black/5 transition-colors"
        aria-label="Toggle mobile menu"
        aria-expanded="false"
      >
        <svg id="menu-open-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
        <svg id="menu-close-icon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Panel -->
  <div id="mobile-menu" class="hidden md:hidden relative">
    <div class="px-6 py-4 space-y-1 border-t
      dark:bg-[var(--color-bg)]/95 dark:border-[var(--color-border)]/50
      bg-[var(--color-bg-light)]/95 border-[var(--color-border-light)]/50
      backdrop-blur-xl">
      {navLinks.map(link => (
        <a
          href={link.href}
          class:list={[
            "block px-4 py-3 text-base font-medium rounded-lg transition-all duration-200",
            currentPath === link.href || (link.href !== '/' && currentPath.startsWith(link.href)) || (link.href === '/content/' && currentPath.startsWith('/blog/'))
              ? "text-[var(--color-accent)] dark:bg-white/5 bg-black/5"
              : "dark:text-[var(--color-text-muted)] text-[var(--color-text-dark-muted)] hover:text-[var(--color-accent)]"
          ]}
        >
          {link.label}
        </a>
      ))}
    </div>
  </div>
</nav>

<!-- Spacer for fixed nav -->
<div class="h-16"></div>

<script is:inline>
  document.addEventListener('astro:page-load', () => {
    // Mobile menu toggle
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const openIcon = document.getElementById('menu-open-icon');
    const closeIcon = document.getElementById('menu-close-icon');

    if (menuBtn && mobileMenu && openIcon && closeIcon) {
      menuBtn.addEventListener('click', () => {
        const isOpen = !mobileMenu.classList.contains('hidden');
        mobileMenu.classList.toggle('hidden');
        openIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');
        menuBtn.setAttribute('aria-expanded', String(!isOpen));
      });

      // Close mobile menu on navigation
      mobileMenu.classList.add('hidden');
      openIcon.classList.remove('hidden');
      closeIcon.classList.add('hidden');
      menuBtn.setAttribute('aria-expanded', 'false');
    }

    // Shrink nav on scroll
    const nav = document.getElementById('main-nav');
    if (nav) {
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          nav.classList.add('py-0');
        } else {
          nav.classList.remove('py-0');
        }
      }, { passive: true });
    }
  });
</script>
